<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>TokoTani</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="keywords" />
    <meta content="" name="description" />

    <!-- Google Web Fonts -->
    <link rel="icon" href="../../public/icon.png" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="./bootstrap.min.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="../styles/index.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Navbar start -->
    <div class="container-fluid fixed-top">
      <div class="container px-0">
        <nav class="navbar navbar-light bg-M navbar-expand-xl">
          <a href="index.html" class="navbar-brand">
            <h1 class="text-primary display-6">TokoTani</h1>
          </a>
          <div class="modal-body d-flex align-items-center">
            <div class="input-group w-75 mx-auto d-flex">
              <input
                type="search"
                class="form-control p-3"
                placeholder="keywords"
                aria-describedby="search-icon-1"
                id="search-input"
              />
              <span
                id="search-icon-1"
                class="input-group-text p-3"
                onclick="handleSearch('search-input')"
                ><i class="fa fa-search"></i
              ></span>
            </div>
          </div>
          <button
            class="navbar-toggler py-2 px-3"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse"
          >
            <span class="fa fa-bars text-primary"></span>
          </button>
          <div class="collapse navbar-collapse bg-M" id="navbarCollapse">
            <div class="d-flex ms-auto m-3 me-0">
              <a
                href="#"
                id="shopping-bag-link"
                class="position-relative me-4 my-auto"
              >
                <i class="fa fa-shopping-bag fa-2x"></i>
              </a>
              <div class="dropdown my-auto" id="profile"></div>
            </div>
          </div>
        </nav>
      </div>
    </div>
    <!-- Navbar End -->

    <div
      class="hero-header"
      style="
        background-image: url('../../public/elaine-casap-qgHGDbbSNm8-unsplash.jpg');
        height: 100vh;
        background-size: cover;
        background-position: center;
      "
    >
      <div class="header-O text-center text-white">
        <h1 style="color: #ffffff">
          Empowering Farmers Connecting Communities
        </h1>
        <p style="color: #ffffff">
          TokoTani is designed to support and uplift farmers by providing a
          platform for efficient and fair agricultural trade. <br />
          Join us in transforming the agricultural landscape and empowering
          local farmers.
        </p>
      </div>
    </div>

    <div
      class="container"
      style="display: flex; gap: 20px; margin-top: 20px"
    ></div>
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
      rel="stylesheet"
    />

    <div class="title-section">Select Category</div>
    <section class="hero-section">

      <div class="card-grid">
        <a class="card" href="./product.html?category=fruits">
          <div
            class="card__background"
            style="
              background-image: url(../../public/josefin-s0fuB1h3yPw-unsplash.jpg);
            "
          ></div>
          <div class="card__content">
            <h3 class="card__heading">FRUIT</h3>
          </div>
        </a>
        <a class="card" href="./product.html?category=vegetables">
          <div
            class="card__background"
            style="
              background-image: url(../../public/sara-scarpa-AJFQGDaFP-s-unsplash.jpg);
            "
          ></div>
          <div class="card__content">
            <h3 class="card__heading">VEGETABLES</h3>
          </div>
        </a>
        <a class="card" href="./product.html?category=meats">
          <div
            class="card__background"
            style="
              background-image: url(../../public/kyle-mackie-MEnlQv-EQvY-unsplash.jpg);
            "
          ></div>
          <div class="card__content">
            <h3 class="card__heading">MEAT</h3>
          </div>
        </a>
        <a class="card" href="./product.html?category=fish">
          <div
            class="card__background"
            style="
              background-image: url(../../public/prince-charles-malaque-fSbr8cRDgAo-unsplash.jpg);
            "
          ></div>
          <div class="card__content">
            <h3 class="card__heading">FISH</h3>
          </div>
        </a>
      </div>
    </section>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./main.js"></script>
  </body>

  <script>
    function decodeJwt(token) {
      try {
        const base64Url = token.split(".")[1];
        const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        const jsonPayload = decodeURIComponent(
          atob(base64)
            .split("")
            .map(function (c) {
              return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join("")
        );
        return JSON.parse(jsonPayload);
      } catch (error) {
        console.error("Error decoding JWT:", error);
        return null;
      }
    }

    $(document).ready(function () {
      const userToken = localStorage.getItem("userToken");
      const decodedToken = decodeJwt(userToken);
      const sellerToken = localStorage.getItem("sellerToken");

      console.log(decodedToken);

      const decodedSeller = decodeJwt(sellerToken);

      console.log(decodedSeller);

      const isSeller = decodedToken.isSeller;
      console.log(isSeller);
      $("#seller-link").click(function (event) {
        event.preventDefault();

        const userToken = localStorage.getItem("userToken");

        if (userToken) {
          const decodedToken = decodeJwt(userToken);
          console.log(isSeller);
          // Check if the decoded token indicates user is a seller
          if (isSeller) {
            // Redirect to seller dashboard
            window.location.href = "./dashbord.html";
          } else {
            // Redirect to seller registration (assuming this is where non-sellers should go)
            window.location.href = "./seller_register.html";
          }
        } else {
          // If no userToken is found, redirect to login page
          window.location.href = "./login.html";
        }
      });

      // Handle click event on shopping bag icon
      $("#shopping-bag-link").click(function (event) {
        event.preventDefault(); // Prevent default link behavior

        // Check if userToken is available
        if (userToken) {
          // Redirect to cart.html
          window.location.href = "./cart_Buyer.html";
        } else {
          // Redirect to login page
          window.location.href = "./login.html";
        }
      });
    });
    document.addEventListener("DOMContentLoaded", function () {
      const userToken = localStorage.getItem("userToken");
      const profile = document.getElementById("profile");
      console.log(userToken);

      if (userToken) {
        profile.innerHTML =
          '<a href="#" class="my-auto" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">' +
          '<i class="fas fa-user fa-2x"></i>' +
          "</a>" +
          '<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink">' +
          '<li><a class="dropdown-item" href="./profile.html">Profile</a></li>' +
          '<li><a class="dropdown-item" id="seller-link" href="#">Go to Seller</a></li>' +
          '<li><a class="dropdown-item" href="#" onclick="logout()">Log Out</a></li>' +
          "</ul>";
      } else {
        profile.innerHTML =
          '<a href="./login.html" class="my-auto">' +
          '<i class="fas fa-sign-in-alt fa-2x"></i>' +
          "</a>";
      }

      function logout() {
        localStorage.removeItem("userToken");
        window.location.reload();
      }

      document
        .getElementById("search-input")
        .addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            handleSearch("search-input");
          }
        });
    });

    function logout() {
      localStorage.removeItem("userToken");
      localStorage.removeItem("sellerToken");
      window.location.reload();
    }

    function handleSearch(inputId) {
      const searchInput = document.getElementById(inputId).value;
      const params = new URLSearchParams(window.location.search);

      // Replace the search query if it exists, or add a new one
      if (searchInput) {
        params.set("search", searchInput);
      } else {
        params.delete("search");
      }

      // Update the URL with the new search query
      window.location.href = `./product.html?${params.toString()}`;
    }
  </script>
</html>
